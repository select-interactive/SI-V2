!function(a,b){window.SI=window.SI||{};var c,d,e;SI.admin=SI.admin||{},SI.admin.news={settings:{projectId:-1,primaryPic:"",logo:"",wsUrl:"/webservices/wsPortfolio.asmx/",wsDisplaymode:2,editorOptions:{allowedContent:!0,toolbar:"Simple"}},elements:{formOptions:a.getElementById("form-option"),ddlItems:a.getElementById("ddl-items"),btnNew:a.getElementById("btn-new"),formProject:a.getElementById("form-project"),dataFields:a.querySelectorAll("[data-field]"),cbIsHttps:a.getElementById("cb-is-https"),cbIsActive:a.getElementById("cb-is-active"),btnItemSave:a.getElementById("btn-project-save"),btnItemCancel:a.getElementById("btn-project-cancel"),btnItemDelete:a.getElementById("btn-project-delete"),status:a.getElementById("status")},init:function(){c=this,d=c.settings,e=c.elements,c.bindEvents(),CKEDITOR.replace("ta-summary",d.editorOptions)},bindEvents:function(){e.ddlItems.addEventListener("change",c.loadItemDetails,!1),e.btnNew.addEventListener("click",c.startNewItem,!1),e.btnItemSave.addEventListener("click",c.saveItem,!1),e.btnItemCancel.addEventListener("click",c.cancel,!1),e.btnItemDelete.addEventListener("click",c.deleteItem,!1)},loadItemDetails:function(){e.status.innerHTML='<p class="info">Loading item details, please wait...</p>',d.projectId=parseInt(e.ddlItems.value,10),SI.ajax(d.wsUrl+"loadPortfolioItemsAsJson",{projectId:d.projectId,isActive:!1},function(a){if(a&&a.d){for(var b,c,f,g=a.d[0].cols,h=e.dataFields,i=0,j=h.length;j>i;i++)b=h[i],c=b.getAttribute("data-field"),f=g[c],"textarea"===b.tagName.toString().toLowerCase()?CKEDITOR.instances[b.id].setData(f):b.value=f;e.cbIsActive.checked=g.isActive?!0:!1,e.cbIsActive.checked=g.isActive?!0:!1,d.primaryPic=g.primaryPic,d.logo=g.logo,e.btnItemDelete.classList.remove("hidden"),e.formOptions.classList.add("hidden"),e.formProject.classList.remove("hidden"),e.status.innerHTML=""}})},startNewItem:function(){c.resetForm(),e.btnItemDelete.classList.add("hidden"),e.formOptions.classList.add("hidden"),e.formProject.classList.remove("hidden"),e.formProject.querySelectorAll("input")[0].focus()},saveItem:function(){for(var a,f,g,h=!1,i=e.formProject.querySelectorAll(".req"),j=e.dataFields,k=0,l=i.length,m={};l>k;k++)a=i[k],g="textarea"===a.tagName.toString().toLowerCase()?b.trim(CKEDITOR.instances[a.id].getData()):b.trim(a.value),""===g?(a.classList.add("invalid"),h=!0):a.classList.remove("invalid");if(h)return e.formProject.querySelectorAll(".invalid")[0].focus(),void 0;for(e.status.innerHTML='<p class="info">Saving project, please wait...</p>',k=0,l=j.length;l>k;k++)a=j[k],f=a.getAttribute("data-field"),g="textarea"===a.tagName.toString().toLowerCase()?b.trim(CKEDITOR.instances[a.id].getData()):b.trim(a.value),m[f]=g;m.projectId=d.projectId,m.primaryPic=d.primaryPic,m.logo=d.logo,m.isHTTPS=e.cbIsHttps.checked,m.isActive=e.cbIsActive.checked,SI.ajax(d.wsUrl+"saveProject",m,function(a){if(a&&a.d){var b=JSON.parse(a.d);b&&b.status&&"success"===b.status?(e.status.innerHTML='<p class="success">The project has been saved successfully.</p>',d.projectId=b.projectId,c.loadItems(),e.btnItemDelete.classList.remove("hidden"),setTimeout(function(){e.status.innerHTML=""},1e3)):e.status.innerHTML='<p class="error">Unable to save the project at this time.'+(b.msg?b.msg:"")+"</p>"}})},cancel:function(){confirm("Are you sure you want to cancel your work?")&&(e.formProject.classList.add("hidden"),e.formOptions.classList.remove("hidden"),d.projectId=-1,c.loadItems(),e.ddlItems.value="-1",window.scrollTo(0,0))},deleteItem:function(){confirm("Are you sure you want to delete this project?")&&(e.status.innerHTML='<p class="info">Deleting project, please wait...</p>',SI.ajax(d.wsUrl+"deleteProject",{projectId:d.projectId},function(a){if(a&&a.d){var b=JSON.parse(a.d);b&&b.status&&"success"===b.status?(e.status.innerHTML='<p class="success">The project has been deleted successfully.</p>',d.projectId=-1,c.loadItems(),setTimeout(function(){c.resetForm(),e.formProject.classList.add("hidden"),e.formOptions.classList.remove("hidden"),e.status.innerHTML=""},1e3)):e.status.innerHTML='<p class="error">Unable to delete the project at this time.'+(b.msg?b.msg:"")+"</p>"}}))},resetForm:function(){d.projectId=-1,d.primaryPic="",d.logo="";for(var a=e.formProject.querySelectorAll("input[type=text], input[type=url]"),b=0,c=a.length;c>b;b++)a[b].value="";e.cbIsHttps.checked=!1,e.cbIsActive.checked=!1,window.scrollTo(0,0)},loadItems:function(){SI.ajax(d.wsUrl+"loadPortfolioItemsAsHtml",{projectId:d.projectId,isActive:!1,displayMode:d.wsDisplaymode},function(a){a&&a.d&&(e.ddlItems.innerHTML=a.d)})}},SI.admin.news.init()}(document,jQuery);